"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getJSONSchemaModel = getJSONSchemaModel;

var _properties = require("./properties");

function getRelationScalarFields(model) {
  return model.fields.flatMap(field => field.relationFromFields || []);
}

function getJSONSchemaModel(modelMetaData, transformOptions) {
  return model => {
    const definitionPropsMap = model.fields.map((0, _properties.getJSONSchemaProperty)(modelMetaData, transformOptions));
    const propertiesMap = definitionPropsMap.map(([name, definition]) => [name, definition]);
    const relationScalarFields = getRelationScalarFields(model);
    const propertiesWithoutRelationScalars = propertiesMap.filter(prop => relationScalarFields.findIndex(field => field === prop[0]) === -1);
    const properties = Object.fromEntries((transformOptions === null || transformOptions === void 0 ? void 0 : transformOptions.keepRelationScalarFields) === 'true' ? propertiesMap : propertiesWithoutRelationScalars);
    const definition = {
      type: 'object',
      properties
    };
    return [model.name, definition];
  };
}